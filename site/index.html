<!doctype html>
<html>
<head>
	<title>Salsa Development 0.0.3</title>
</head>
<body>
<h1>Salsa Development</h1>
<p>Status:<br><b class="js-status">Disconnected</b></p>
<form class="js-form">
	<input type="number" class="js-input"/>
	<button type="submit">Rotate</button>
</form>
</body>
<script src="/socket.io/socket.io.js"></script>
<script>
	var statusEl = document.getElementsByClassName('js-status')[0];
	var socket = io(),
		_salsaId;

	// Socket IO
	socket.on('connect', onConnect);
	socket.on('connect_error', onConnectError);
	socket.on('connect_timeout', onConnectTimeout);
	socket.on('reconnect', onReconnect);
	socket.on('reconnect_attempt', onReconnectAttempt);
	socket.on('reconnecting', onReconnecting);
	socket.on('reconnect_error', onReconnectError);
	socket.on('reconnect_failed', onReconnectFailed);

	socket.on('salsaConnectedAs', onSalsaConnectedAs);


	/**
	 * Fired upon successful Salsa connection
	 * @param {String} id
	 */
	function onSalsaConnectedAs(id) {

		updateStatus('onSalsaConnectedAs - ' +  id);
		_salsaId = id;
	}

	/**
	 * Fired upon a successful reconnection
	 * @param {Number} reconnectionAttemptNumber
	 */
	function onReconnect(reconnectionAttemptNumber) {
		updateStatus('onReconnect - reconnectionAttemptNumber - ' + reconnectionAttemptNumber);
	}

	/**
	 * Fired upon an attempt to reconnect
	 */
	function onReconnectAttempt() {
		updateStatus('onReconnectAttempt');
	}

	/**
	 * Fired upon an attempt to reconnect
	 * @param {Number} reconnectionAttemptNumber
	 */
	function onReconnecting(reconnectionAttemptNumber) {
		updateStatus('onReconnecting - reconnectionAttemptNumber - ' + reconnectionAttemptNumber);
	}

	/**
	 * Fired upon a reconnection attempt error
	 * @param {Object} error
	 */
	function onReconnectError(error) {
		updateStatus('onReconnectError - error - ' + JSON.stringify(error));
	}

	/**
	 * Fired when couldnâ€™t reconnect within `reconnectionAttempts`
	 */
	function onReconnectFailed() {
		updateStatus('onReconnectFailed');
	}

	/**
	 * Fired upon a successful connection
	 */
	function onConnect() {

		updateStatus('onConnect');
		socket.emit('connectSalsa');
	}

	/**
	 * Fired upon a connection error
	 * @param {Object} error
	 */
	function onConnectError(error) {
		updateStatus('onConnectError - error - ', JSON.stringify(error));
	}

	/**
	 * Fired upon a connection timeout
	 */
	function onConnectTimeout() {

		updateStatus('onConnectTimeout');
	}


	var formEl = document.getElementsByClassName('js-form')[0];
	var inputEl = document.getElementsByClassName('js-input')[0];

	formEl.addEventListener('submit', onSubmit);

	function onSubmit(e) {

		e.preventDefault();

		var angle = inputEl.value;

		socket.emit('rotate', angle);
	}

	function updateStatus(status) {

		statusEl.innerHTML = status;
	}
</script>
</html>
