<!doctype html>
<html>
<head>
	<title>Salsa Development 0.0.3</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style>

		body {

			margin: 0;
		}

		body, html, .wrapper {

			width: 100%;
			height: 100%;
		}

		.wrapper {

			padding: 20px;
			box-sizing: border-box;
		}
	</style>
</head>
<body>
<div class="wrapper">
<h1>Salsa Development</h1>
<p>Status:<br><b class="js-status">Disconnected</b></p>
<p>Rotation:<br><b class="js-rotation">0</b></p>
</div>
</body>
<script src="/socket.io/socket.io.js"></script>
<script src="http://hammerjs.github.io/dist/hammer.min.js"></script>
<script>
	var statusEl = document.getElementsByClassName('js-status')[0];
	var rotationEl = document.getElementsByClassName('js-rotation')[0];
	var socket = io(),
		_salsaId;

	// Socket IO
	socket.on('connect', onConnect);
	socket.on('connect_error', onConnectError);
	socket.on('connect_timeout', onConnectTimeout);
	socket.on('reconnect', onReconnect);
	socket.on('reconnect_attempt', onReconnectAttempt);
	socket.on('reconnecting', onReconnecting);
	socket.on('reconnect_error', onReconnectError);
	socket.on('reconnect_failed', onReconnectFailed);

	socket.on('salsaConnectedAs', onSalsaConnectedAs);


	/**
	 * Fired upon successful Salsa connection
	 * @param {String} id
	 */
	function onSalsaConnectedAs(id) {

		updateStatus('onSalsaConnectedAs - ' +  id);
		_salsaId = id;
	}

	/**
	 * Fired upon a successful reconnection
	 * @param {Number} reconnectionAttemptNumber
	 */
	function onReconnect(reconnectionAttemptNumber) {
		updateStatus('onReconnect - reconnectionAttemptNumber - ' + reconnectionAttemptNumber);
	}

	/**
	 * Fired upon an attempt to reconnect
	 */
	function onReconnectAttempt() {
		updateStatus('onReconnectAttempt');
	}

	/**
	 * Fired upon an attempt to reconnect
	 * @param {Number} reconnectionAttemptNumber
	 */
	function onReconnecting(reconnectionAttemptNumber) {
		updateStatus('onReconnecting - reconnectionAttemptNumber - ' + reconnectionAttemptNumber);
	}

	/**
	 * Fired upon a reconnection attempt error
	 * @param {Object} error
	 */
	function onReconnectError(error) {
		updateStatus('onReconnectError - error - ' + JSON.stringify(error));
	}

	/**
	 * Fired when couldnâ€™t reconnect within `reconnectionAttempts`
	 */
	function onReconnectFailed() {
		updateStatus('onReconnectFailed');
	}

	/**
	 * Fired upon a successful connection
	 */
	function onConnect() {

		updateStatus('onConnect');
		socket.emit('connectSalsa');
	}

	/**
	 * Fired upon a connection error
	 * @param {Object} error
	 */
	function onConnectError(error) {
		updateStatus('onConnectError - error - ', JSON.stringify(error));
	}

	/**
	 * Fired upon a connection timeout
	 */
	function onConnectTimeout() {

		updateStatus('onConnectTimeout');
	}

	var currentAngle = 0,
		initialAngle;


	function updateStatus(status) {

		statusEl.innerHTML = status;
	}

	var hammertime = new Hammer(document.getElementsByClassName('wrapper')[0], {});


	hammertime.on('panstart', function(ev) {

		initialAngle = currentAngle;
	});

	hammertime.on('pan', function(ev) {

		currentAngle = roundToTen(initialAngle - Math.round(ev.deltaX*0.1));

		var displayAngle;

		if(currentAngle < 0) {

			displayAngle = 360 + (currentAngle % 360);

		} else {

			displayAngle = currentAngle % 360;
		}

		rotationEl.innerHTML = displayAngle;

		socket.emit('rotate', currentAngle);
	});

	function roundToTen(value) {

		return Math.round(value / 10) * 10;
	}
</script>
</html>
