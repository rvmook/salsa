<script>

	(function(win, doc){

		// If init is called before JavaScript is loaded, global `isReady` boolean is set.
		win.init = function(){ win.isReady = true; };

		var MOBILE_ASSET = 'mobile',
			assetFile = getAssetFile(),
			hasLocalStorage = 'localStorage' in win && win['localStorage'] !== null,
			localStrg,
			{{#unless isProd}}timeStamp = '?dev=' + Date.now(),{{/unless}}
			jsFile = '/assets/scripts/' + assetFile + '.js'{{#unless isProd}} + timeStamp {{/unless}},
			JS_FILE = 'JS_FILE',
			JS_DATA = 'JS_DATA',

			pixiFile = '/assets/scripts/three.min.js'{{#unless isProd}} + timeStamp {{/unless}},
			THREE_FILE = 'THREE_FILE',
			THREE_DATA = 'THREE_DATA',

			cssFile = '/assets/styles/' + assetFile + '.css'{{#unless isProd}} + timeStamp {{/unless}},
			CLASS_INLINE_CSS = 'js-inlineStyle',
			CSS_FILE = 'CSS_FILE',
			CSS_DATA = 'CSS_DATA';


		loadFile(pixiFile, THREE_FILE, THREE_DATA, 'script', function(){
			loadFile(jsFile, JS_FILE, JS_DATA, 'script', function(){
				loadFile(cssFile, CSS_FILE, CSS_DATA, 'style', win.init);
			});
		});


		function loadFile(url, keyFile, keyData, tagName, callback) {

			callback = callback || function(){};

			if(assetFile === MOBILE_ASSET && url === pixiFile) {

				callback();
				
			} else if(hasLocalStorage) {

				localStrg = localStorage;

				if(localStrg.getItem(keyFile) !== url) {

					localStrg.setItem(keyFile, url);

					load();

				} else {

					handleFile(tagName, localStrg.getItem(keyData));

					callback();
				}

			} else {

				load();
			}

			function load() {

				loadUrl(url, function(response) {

					if(hasLocalStorage) {

						localStrg.setItem(keyData, response);
					}

					{{!-- Scripts are loaded through <script> tag in development for sourcemap support. --}}
					{{#if isProd}}

						handleFile(tagName, response);


					{{else}}

						if(tagName === 'script') {

							addScriptTag(url);

						} else {

							handleFile(tagName, response);
						}

						function addScriptTag(src) {

							var scriptEl = doc.createElement('script');

							scriptEl.setAttribute('src', src);

							doc.body.appendChild(scriptEl);
						}

					{{/if}}


					callback();
				});
			}
		}

		function handleFile(tagName, content) {

			var el;

			if(tagName) {

				el = doc.createElement(tagName);

				if(tagName === 'style') {

					el.className = CLASS_INLINE_CSS;
				}
				el.innerHTML = content;
				doc.body.appendChild(el);

			} else {

				doc.body.innerHTML += content;
			}
		}

		function loadUrl(url, callback) {
			var request = new XMLHttpRequest();
			request.open('GET', url, true);
			request.onreadystatechange = function () {

				if (request.readyState != 4 || request.status != 200) {

					return

				} else {

					callback(request.responseText);
				}
			};
			request.send();
		}

		function getAssetFile() {

			if(win.matchMedia && win.matchMedia('(max-device-width:1024px)').matches) {

				return MOBILE_ASSET;

			} else {

				return 'desktop';
			}
		}
	})(window, document);

</script>